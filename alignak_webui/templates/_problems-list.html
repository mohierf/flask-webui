{# alignak_webui/templates/_problems-list.html_ #}

<h2 class="page-header">System livestate</h2>
{% set ls = helper.get_livestate( {"sort": 'state'} ) %}
<div class="row">
    <div class="panel panel-default">
        <div class="panel-body">
            <button type="button" class="btn btn-default btn-xs pull-left" data-type="business-impact" data-business-impact="4" data-state="off">Select all elements</button>

            <i class="pull-right small">5 elements</i>
            <h3 class="text-center">Business impact: {{ helper.get_html_business_impact(4, icon=True, text=True)|safe }}</h3>

            <!-- TODO ... data- ... -->
            <table class="table table-invisible table-condensed">
                <thead><tr>
                    <th width="20px"></th>
                    <th width="40px"></th>
                    <th width="60px">Host</th>
                    <th width="90px">Service</th>
                    <th width="90px">State</th>
                    <th class="hidden-sm hidden-xs" width="90px">Duration</th>
                    <th class="hidden-sm hidden-xs" width="100%">Output</th>
                </tr></thead>

                <tbody>
                {% set current_host = '' %}
                {% for item in ls %}
                    <tr data-toggle="collapse" data-target="#details-{{ helper.get_html_id(item['type'], item['name']) }}" class="accordion-toggle">
                        <td>
                            <input type="checkbox" class="input-sm" value="" id="selector-{{i}}" data-type="problem" data-business-impact="0" data-item="xxxx">
                        </td>
                        <td>
                            {{ helper.get_html_state(item["type"], item["state"])|safe }}
                        </td>
                        <td>
                            {% if current_host != item['host_name']['host_name'] %}
                                {% set current_host = item['host_name']['host_name'] %}
                                {{ helper.get_html_url("host", item['host_name']['host_name'])|safe }}
                            {% endif %}
                        </td>
                        <td>
                            {% if item['type'] == "host" %}
                                Host check
                            {% else %}
                                {{ helper.get_html_url("service", item['service_description']['service_description'])|safe }}
                            {% endif %}
                        </td>
                        <td class="font-{{ item['state'].lower() }}"><strong>{{ item['state'] }}</strong></td>
                        <td class="hidden-sm hidden-xs">
                            {{ helper.print_duration(item['last_state_change'], duration_only=True, x_elts=2)|safe }}
                        </td>
                        <td class="hidden-sm hidden-xs">
                            {{ item['output'] }}
                            {% if item['long_output'] %}
                                <button type="button" class="btn btn-xs btn-info" data-toggle="popover" title="Long output" data-content="Long check output ...Long check output ...Long check output ...Long check output ...Long check output ...">
                                {{ item['long_output'] }}
                                </button>
                            {% endif %}
                        </td>
                    </tr>
                    <tr>
                        <td colspan="20" class="hiddenRow">
                            <div class="accordion-body collapse" id="details-{{ helper.get_html_id(item['type'], item['name']) }}">
                                <table class="table table-condensed">
                                    <tr>
                                    {% if item['type'] == "host" %}
                                        {% if item['host_name']['passive_checks_enabled'] %}
                                        <td>
                                            <i class="fa fa-arrow-left" title="Passive checks are enabled."></i>
                                            {% if item['host_name']['freshness_threshold'] %}
                                            <i title="Freshness check is enabled">(Freshness threshold: {{item['host_name']['freshness_threshold']}} seconds)</i>
                                            {% endif %}
                                        </td>
                                        {% endif %}
                                        {% if item['host_name']['active_checks_enabled'] %}
                                        <td>
                                            <i class="fa fa-arrow-right" title="Active checks are enabled."></i>
                                            <i>Last check <strong>{{ helper.print_duration(item['last_check'], duration_only=True, x_elts=2)|safe }}</strong>, next check in <strong>???</strong>, attempt <strong>???</strong></i>
                                        </td>
                                        {% endif %}
                                    {% else %}
                                        {% if item['service_description']['passive_checks_enabled'] %}
                                        <td>
                                            <i class="fa fa-arrow-left" title="Passive checks are enabled."></i>
                                            {% if item['service_description']['freshness_threshold'] %}
                                            <i title="Freshness check is enabled">(Freshness threshold: {{item['service_description']['freshness_threshold']}} seconds)</i>
                                            {% endif %}
                                        </td>
                                        {% endif %}
                                        {% if item['service_description']['active_checks_enabled'] %}
                                        <td>
                                            <i class="fa fa-arrow-right" title="Active checks are enabled."></i>
                                            <i>Last check <strong>{{ helper.print_duration(item['last_check'], duration_only=True, x_elts=2)|safe }}</strong>, next check in <strong>???</strong>, attempt <strong>???</strong></i>
                                        </td>
                                        {% endif %}
                                    {% endif %}
                                        {% if current_user.can_action() %}
                                        <td align="right">
                                            <div class="btn-group" role="group" data-type="actions" aria-label="Actions">
                                                <button class="btn btn-default btn-xs"
                                                data-type="action" action="event-handler"
                                                data-toggle="tooltip" data-placement="bottom" title="Try to fix (launch event handler)"
                                                data-element="test">
                                                <i class="fa fa-magic"></i><span class="hidden-sm hidden-xs"> Try to fix</span>
                                                </button>
                                                <button class="btn btn-default btn-xs"
                                                data-type="action" action="recheck"
                                                data-toggle="tooltip" data-placement="bottom" title="Launch the check command"
                                                data-element="test">
                                                <i class="fa fa-refresh"></i><span class="hidden-sm hidden-xs"> Refresh</span>
                                                </button>
                                                <button class="btn btn-default btn-xs"
                                                data-type="action" action="check-result"
                                                data-toggle="tooltip" data-placement="bottom" title="Submit a check result"
                                                data-element="test"
                                                data-user="utilisateur">
                                                <i class="fa fa-share"></i><span class="hidden-sm hidden-xs"> Submit check result</span>
                                                </button>
                                                <button class="btn btn-default btn-xs"
                                                data-type="action" action="add-acknowledge"
                                                data-toggle="tooltip" data-placement="bottom" title="Acknowledge this problem"
                                                data-element="test">
                                                <i class="fa fa-check"></i><span class="hidden-sm hidden-xs"> Acknowledge</span>
                                                </button>
                                                <button class="btn btn-default btn-xs"
                                                data-type="action" action="schedule-downtime"
                                                data-toggle="tooltip" data-placement="bottom" title="Schedule a downtime for this problem"
                                                data-element="test">
                                                <i class="fa fa-ambulance"></i><span class="hidden-sm hidden-xs"> Downtime</span>
                                                </button>
                                                <button class="btn btn-default btn-xs"
                                                data-type="action" action="ignore-checks"
                                                data-toggle="tooltip" data-placement="bottom" title="Ignore checks for the service (disable checks, notifications, event handlers and force Ok)"
                                                data-element="test"
                                                data-user="utilisateur">
                                                <i class="fa fa-eraser"></i><span class="hidden-sm hidden-xs"> Remove</span>
                                                </button>
                                            </div>
                                        </td>
                                        {% endif %}
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
